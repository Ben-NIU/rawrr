---
title: rawR - Technical Note, Journal of Proteome Research, Second Biennial Special
  Issue on Software Tools and Resources in February 2021
author: "Tobias Kockmann^1‡^ & Christian Panse^1,2‡^"
date: "`r Sys.Date()`"
bibliography: rawR.bib
output:
  html_document:
    df_print: paged
    citation_package: natbib
  pdf_document: default
vignette: |
  %\usepackage[utf8]{inputenc}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::knitr} %\VignetteIndexEntry{rawR JPR Technical Note}
  %\VignetteEngine{knitr::rmarkdown}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

^1^Functional Genomics Center Zurich, ETH Zurich / University of Zurich,
Winterthurerstrasse 190, 8057 Zurich, Switzerland

^2^Swiss Institute of Bioinformatics, Quartier Sorge - Batiment Amphipole,
1015 Lausanne, Switzerland

## Abstract

The Bioconductor project has shown that the R statistical environment is a
highly valuable tool for genomics data analysis
[@Huber2015], but with respect to proteomics
we are still missing low level infrastructure to enable performant and robust
analysis workflows in R. Fundamentally important are libraries that provide
raw data access. Our R package rawDiag [@Trachsel2018]
has provided the proof-of-principle how access to mass spectromerty raw files
can be realized by wrapping vendor-provided APIs. Our novel package rawR now
aims for complete, OS independent access to all spectral, chromatographic and
meta data logged in Thermo Fisher Scientific raw files. rawR interoperates with
other R packages for proteomics data visualisation (protViz) and will ...

## Keywords

computational mass spectrometry, software, R package

## Introduction

...


## Implementation

### C# code

### R

Mass spectrometry (MS) uses two basic building blocks (data items): 1. mass spectrum, 2. chromatogram. All mass spectra are recorded by scanning detectors (mass analyzers) that log signal intensities for ranges of mass to charge ratios (m/z), also referred to as position. These recordings can be of continuous nature so called profile data, or appear centroided in case discrete information (tuples of position and intensity values) is sufficient. This heavily compacted data structure is often called a peak list. In addition to signal intensities, peak list can also cover additional attributes like peak resolution, charge, or local noise around the peak. In short, the additional attributes further described the nature of the original profile signal, or help to group peak lists with respect to their molecular nature or processing history. A well-known example is the assignment of peaks to peak groups that constitute isotope patterns (M, M+1, M+2, ...). Chromatograms come in different flavours, but are always signal intensity values as a function of time. Signal intensities can be point estimates from scanning detectors or plain intensities from non scaning detectors (e.g. UV trace). Point estimates can be defined in different ways by for instance summing all signals of a given spectrum (total ion chromatogram or TIC), or by extracting signal around an expected value (extracted ion chromatogram = XIC), or by using the maximum signal (base peak chromatogram = BPC). On top, chromatograms can be computed from pre-filtered lists of scans. A total ion chromatogram (TIC) for instance is typically generated by iterating over all MS1-level scans. 

We therefore decided to implemented objects in R that closely resemble these basic building blocks. The spectrum object is technically a nested list (S3 class system). Apart from the peak list the spectrum object also stores meta information on how the scan was recorded and how it relates to other scans in the raw file. This meta information is grouped for better transparency. The chromatogram object ...


|function|description|
|--------|-----------|
|readFileHeader|extracts some meta information from a given rawfile.|
|readIndex|read scan index|
|readSpectrum|reads scan information, e.g., charge, mZ, or intensity of a given set of scan numbers using a dot net interface and the ThermoFisher NewRawFileReader libraries.|
|readChromatogram|extracts Chromatogram|

### Example data

The binary example file sample.raw contains 574 fourier-transformed orbi trap spectra (FTMS) recorded on a Thermo Fisher Scientific Q Exactive HF-X. The mass spectrometer was operated in line with a nano electrospray source (NSI) in positive mode (+). All spectra were written to disk after applying centroiding (c) and lock mass correction. Additional raw data for demonstration and extended testing is available through the [tartare package](https://bioconductor.org/packages/tartare/). Lions love raw meat!

## Results

### Use Case I - Analyzing orbi trap spectra

plotting

```{r plot.rawRspectrum, fig.cap="plot a mass spectrum."}
library(rawR)
exampleData <- file.path(path.package(package = 'rawR'), 'extdata', 'sample.raw')
S <- rawR::readSpectrum(rawfile = exampleData, scan = 1:10)
plot(S[[1]])
```




### Use Case II - Working with chromatograms - iRT regression

<!---
your comme
scp fgcz-r-035:/srv/www/htdocs/p2692/Proteomics/QEXACTIVEHFX_1/tobiasko_20180220_scanSpeed/20180220_14_autoQC01.raw ~/Downloads
-->
```{r plot.rawRchromatogram, fig.cap="plot a chromatogram (XIC)", error=TRUE}
rawfile <- file.path(Sys.getenv('HOME'), "Downloads", "20180220_14_autoQC01.raw")

iRT <- c(487.2571, 547.2984, 622.8539, 636.8695, 644.8230, 669.8384, 683.8282,
            683.8541, 699.3388, 726.8361, 776.9301)

names(iRT) <- c("LGGNEQVTR", "YILAGVENSK", "GTFIIDPGGVIR", "GTFIIDPAAVIR",
                 "GAGSSEPVTGLDAK", "TPVISGGPYEYR", "VEATFGVDESNAK",
                 "TPVITGAPYEYR", "DGLDAASYYAPVR", "ADVTPADFSEWSK",
                 "LFLQFGAQGSPFLK")

C <- readChromatogram(rawfile, iRT)

plot(C)
```



## Conclusions

...


## Author information

### Corresponding author

Tobias Kockmann  
E-mail: <tobias.kockmann@fgcz.ethz.ch>

### ORCID

Christian Panse <https://orcid.org/0000-0003-1975-3064>  
Tobias Kockmann <https://orcid.org/0000-0002-1847-885X>  

### Author contributions

The manuscript was written through contributions of all authors. All authors have given approval to the final version of the manuscript. ‡These authors contributed equally.


## Funding Sources

Any funds used to support the research of the manuscript should be placed here (per journal style).


## Acknowledgements

We thank Lilly van de Venn for designing the rawR package logo.


## Abbreveations

MS, mass spectromerty; TIC, total ion chromatogram;
XIC, extracted ion chromatogram; fourier-transformed mass spectrum (FTMS);
nano spray ionisation, NSI;


# References



